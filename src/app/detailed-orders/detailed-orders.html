<mat-card class="report-card">
    <!-- <h2>Order Report</h2> -->

    <div class="summary" align:center>
        <mat-card class="summary-card">
            <h3>Total Sales</h3>
            <h3>₹ {{ grandTotal() }}</h3>
        </mat-card>
    </div>

    <mat-accordion>
        <mat-expansion-panel #filterPanel>
            <mat-expansion-panel-header>
                <mat-panel-title>Date Filters</mat-panel-title>
                <mat-panel-description>
                </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="filters">
                <!-- SINGLE DATE -->
                <mat-form-field appearance="outline">
                    <mat-label>Date</mat-label>
                    <input matInput [matDatepicker]="sd" (dateChange)="onSelectedDate($event.value, filterPanel)" />
                    <mat-datepicker-toggle matSuffix [for]="sd"></mat-datepicker-toggle>
                    <mat-datepicker #sd></mat-datepicker>
                </mat-form-field>

                <!-- FROM -->
                <mat-form-field appearance="outline">
                    <mat-label>From</mat-label>
                    <input matInput [matDatepicker]="f" (dateChange)="onFromDateChange($event.value, filterPanel)" />
                    <mat-datepicker-toggle matSuffix [for]="f"></mat-datepicker-toggle>
                    <mat-datepicker #f></mat-datepicker>
                </mat-form-field>

                <!-- TO -->
                <mat-form-field appearance="outline">
                    <mat-label>To</mat-label>
                    <input matInput [matDatepicker]="t" (dateChange)="onToDateChange($event.value, filterPanel)" />
                    <mat-datepicker-toggle matSuffix [for]="t"></mat-datepicker-toggle>
                    <mat-datepicker #t></mat-datepicker>
                </mat-form-field>
            </div>
            <mat-divider />
            <div class="preset-buttons">
                <button mat-stroked-button (click)="setYesterday(filterPanel)">Yesterday</button>
                <button mat-stroked-button color="primary" (click)="setThisWeek(filterPanel)">This Week</button>
                <button mat-stroked-button (click)="setThisMonth(filterPanel)">This Month</button>
            </div>
            <mat-divider />
            <div class="filter-actions">
                <button mat-raised-button color="warn" type="button" (click)="resetFilters(filterPanel)">
                    Reset
                </button>
            </div>
        </mat-expansion-panel>
    </mat-accordion>


    <!-- GROUPED ORDERS -->
    <ng-container *ngFor="let g of groupedOrders()">
        <h3 class="date-header">
            {{ g.date }} — ₹{{ g.total }}
        </h3>

        <mat-accordion>
            <mat-expansion-panel *ngFor="let o of g.orders; trackBy: trackByInvoice">
                <mat-expansion-panel-header class="panel-header">
                    <mat-panel-title>{{ o.invoiceNumber }}</mat-panel-title>
                    <mat-panel-description>₹{{ o.total }}</mat-panel-description>
                </mat-expansion-panel-header>

                <!-- ITEMS -->
                <table class="items-table">
                    <tr>
                        <th>Item</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                    <tr *ngFor="let i of o.items">
                        <td>
                            {{ i.name }}
                            <small *ngIf="i.portion">({{ i.portion }})</small>
                        </td>
                        <td>{{ i.quantity }}</td>
                        <td>₹{{ i.price }}</td>
                        <td>₹{{ i.total }}</td>
                    </tr>
                </table>
            </mat-expansion-panel>
        </mat-accordion>
    </ng-container>

    <div class="empty" *ngIf="!groupedOrders().length">
        No orders placed.
    </div>
</mat-card>